(function(a){if(typeof define==="function"&&define.amd){define(["jquery","load-image","load-image-meta","load-image-exif","load-image-ios","canvas-to-blob","./jquery.fileupload-process"],a)
}else{a(window.jQuery,window.loadImage)
}}(function(a,b){a.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",always:true,disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:true,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",disabled:"@disableImageResize"},{action:"saveImage",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",always:true,prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"});
a.widget("blueimp.fileupload",a.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png)$/,loadImageMaxFileSize:10000000,imageMaxWidth:1920,imageMaxHeight:1080,imageCrop:false,disableImageResize:true,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:true,previewThumbnail:true,previewCrop:false,previewCanvas:true},processActions:{loadImage:function(g,d){if(d.disabled){return g
}var f=this,e=g.files[g.index],c=a.Deferred();
if((a.type(d.maxFileSize)==="number"&&e.size>d.maxFileSize)||(d.fileTypes&&!d.fileTypes.test(e.type))||!b(e,function(h){if(!h.src){return c.rejectWith(f,[g])
}g.img=h;c.resolveWith(f,[g])
},d)){c.rejectWith(f,[g])
}return c.promise()
},resizeImage:function(i,e){if(e.disabled){return i
}var f=this,c=a.Deferred(),h=function(k){i[k.getContext?"canvas":"img"]=k;
c.resolveWith(f,[i])
},j,d,g;e=a.extend({canvas:true},e);
if(i.exif){if(e.orientation===true){e.orientation=i.exif.get("Orientation")
}if(e.thumbnail){j=i.exif.get("Thumbnail");
if(j){b(j,h,e);
return c.promise()
}}}d=(e.canvas&&i.canvas)||i.img;
if(d){g=b.scale(d,e);
if(g.width!==d.width||g.height!==d.height){h(g);
return c.promise()
}}return i},saveImage:function(h,e){if(!h.canvas||e.disabled){return h
}var g=this,f=h.files[h.index],d=f.name,c=a.Deferred(),i=function(j){if(!j.name){if(f.type===j.type){j.name=f.name
}else{if(f.name){j.name=f.name.replace(/\..+$/,"."+j.type.substr(6))
}}}h.files[h.index]=j;
c.resolveWith(g,[h])
};if(h.canvas.mozGetAsFile){i(h.canvas.mozGetAsFile((/^image\/(jpeg|png)$/.test(f.type)&&d)||((d&&d.replace(/\..+$/,""))||"blob")+".png",f.type))
}else{if(h.canvas.toBlob){h.canvas.toBlob(i,f.type)
}else{return h
}}return c.promise()
},loadImageMetaData:function(f,d){if(d.disabled){return f
}var e=this,c=a.Deferred();
b.parseMetaData(f.files[f.index],function(g){a.extend(f,g);
c.resolveWith(e,[f])
},d);return c.promise()
},saveImageMetaData:function(f,d){if(!(f.imageHead&&f.canvas&&f.canvas.toBlob&&!d.disabled)){return f
}var e=f.files[f.index],c=new Blob([f.imageHead,this._blobSlice.call(e,20)],{type:e.type});
c.name=e.name;
f.files[f.index]=c;
return f},setImage:function(e,d){var c=e.canvas||e.img;
if(c&&!d.disabled){e.files[e.index][d.name||"preview"]=c
}return e}}})
}));